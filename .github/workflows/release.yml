name: Release

on:
  push:
    tags:
      - "*"

jobs:
  build-and-release:
    name: Build and Upload Release Assets
    runs-on: macos-26

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Get Version from Tag
        id: version
        run: echo "tag=${GITHUB_REF#refs/*/}" >> $GITHUB_OUTPUT

      - name: Select Xcode
        run: |
          sudo xcode-select -s /Applications/Xcode_26.1.app/Contents/Developer
          xcodebuild -version

      - name: Check Swift Version
        run: swift --version

      - name: Build Release Binary
        run: |
          swift build -c release --arch arm64

      - name: Prepare Binary
        run: |
          mkdir -p release
          cp .build/arm64-apple-macosx/release/files release/files
          chmod +x release/files
          cd release
          tar -czf files-macos-arm64-${{ steps.version.outputs.tag }}.tar.gz files

      - name: Release
        uses: softprops/action-gh-release@v2
        with:
          files: "files-macos-arm64-${{ steps.version.outputs.tag }}.tar.gz"
